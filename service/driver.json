{
  "id": "http://schema.ninjablocks.com/service/driver",
  "$schema": "/service",
  "description": "This service is required to be implemented by all Drivers",
  "methods": {
    "start": {
      "description": "Starts the driver",
      "params": [
        {
          "name": "config",
          "description": "Driver configuration object",
          "value": {
            "type": "object"
          }
        }
      ],
      "returns": {
        "value": { "$ref": "/state/common#/definitions/success" }
      }
    },
    "stop": {
      "description": "Stops the driver, and any devices it has created since starting.",
      "returns": {
        "value": { "$ref": "/state/common#/definitions/success" }
      }
    },
    "createDevice": {
      "description": "Create a new device using the provided configuration.",
      "params": [
        {
          "name": "driverData",
          "value": { "$ref": "#/definitions/device-driver-data" }
        },
        {
          "name": "announcementData",
          "description": "Announcement data. This gets added to the device announcement.",
          "value": {
            "type": "object"
          }
        }
      ],
      "returns": {
        "value": { "$ref": "/state/common#/definitions/success" }
      }
    },
    "startDevice": {
      "description": "Create a new device using the provided configuration.",
      "params": [
        {
          "name": "config",
          "description": "Driver configuration object",
          "value": {
            "type": "object"
          }
        }
      ],
      "returns": {
        "value": {
          "type": "boolean"
        },
        "description": "'true' indicates device started successfully"
      }
    }
  },
  "events": {
    "announce": {
      "value": { "$ref": "#/definitions/driver-announcement" }
    },
    "device-found": {
      "value": { "$ref": "#/definitions/device-driver-data" }
    },
    "device-ready": {
      "value": { "$ref": "#/definitions/device-announcement" }
    },
    "device-started": {
      "value": { "$ref": "#/definitions/device-announcement" }
    }
  },
  "definitions": {
    "device-driver-data": {
      "description": "Whatever is needed by the driver in order to create the device",
      "type": "object"
    },
    "device-announcement": {
      "properties": {
        "id": { "$ref": "/common#/definitions/device-id" },
        "name": {
          "type": "string",
          "minLength": 0
        },
        "driver_data": { "$ref": "#/definitions/device-driver-data" },
        "confirmed": {
          "type": "boolean",
          "description": "Indicates that this device has been seen and confirmed by a human to add to Sphere."
        },
        "signatures": {
          "type": "object",
          "patternProperties": {
            "^[a-z]((:|)[a-z-]+)+$": {
              "type": "string"
            }
          },
          "additionalProperties": false
        },
        "driver": {
          "properties": {
            "name": {
              "type": "string"
            },
            "version": {
              "type": "string"
            }
          },
          "required": [
            "name",
            "version"
          ],
          "additionalProperties": false
        }
      },
      "required": [
        "id",
        "driver"
      ],
      "additionalProperties": false
    },
    "driver-announcement": {
      "properties": {
        "name": {
          "type": "string",
          "minLength": 0
        },
        "file": {
          "type": "string"
        },
        "package": {
          "allOf": [
            { "$ref": "/package.json#/definitions/structure" },
            {
              "required": [
                "name",
                "author",
                "description",
                "version",
                "license"
              ]
            }
          ]
        },
        "defaultConfig": {
          "type": "object"
        }
      },
      "required": [
        "name",
        "file",
        "package"
      ],
      "additionalProperties": false
    }
  }
}